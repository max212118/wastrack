<div class="container-dashboard">
  <div class="cards">

    <div id="mapdiv">
      <div class="card-category" style="width: 100%; height: 80%;">
      	<div class="statistics-menu">
          <div class= "d-flex" id="rec-effect">
            <h5>Carte Live</h5>
            <div id="rec-circle" class= "blink">
              <i class="fa fa-circle"></i>
            </div>
          </div>
          <div>
            <button type="button" class="btn btn-warning"><%= localize( Date.today, format: '%d %B') %></button>
          </div>
		    </div>
        <div style="width: 100%; height: 100%;"
            data-controller="mapbox"
            data-mapbox-markers-value="<%= @markers.to_json %>"
            data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
        </div>
      </div>
    </div>

	<div id="infodiv" class="card-category">
		<div class="statistics-menu">
      <div>
			  <h5>Informations utiles</h5>
      </div>
      <div>
			  <button type="button" class="btn btn-warning"><%= localize( Date.today, format: '%B') %></button>
      </div>
		</div>
		<div class="info-content">
			<section class="statis mt-4 text-center">
				<div class="info-top-d-flex">
					<div class="info-comp">
					<% if @containers_red_count < 2 %>
						<div class="box bg-success p-3">
					<% elsif @containers_red_count < 4 %>
						<div class="box bg-warning p-3">
					<% else %>
						<div class="box bg-danger p-3">
					<% end %>
							<i class="fa-solid fa-trash"></i>
							<h3><%= @containers_red_count %></h3>
							<p class="lead">Containers pleins depuis 2j+</p>
						</div>
					</div>
					<div class="info-comp">
						<% if @average_fill > 6 %>
							<div class="box bg-success p-3">
						<% elsif @average_fill > 4 %>
							<div class="box bg-warning p-3">
						<% else %>
							<div class="box bg-danger p-3">
						<% end %>
							<i class="fa-solid fa-clock"></i>
								<h3> <%= @average_fill %> j</h3>
							<p class="lead">Temps de remplissage</p>
						</div>
					</div>
				</div>
				<div class="info-bot-d-flex">
					<div class="info-comp">
					<% if @dist_moyenne < 30 %>
						<div class="box bg-success p-3">
					<% elsif @dist_moyenne < 60 %>
						<div class="box bg-warning p-3">
					<% else %>
						<div class="box bg-danger p-3">
					<% end %>
							<i class="fa-solid fa-bus"></i>
							<h3> <%= @dist_moyenne %> km</h3>
							<p class="lead">Distance moyenne par jour</p>
						</div>
					</div>
					<div class="info-comp">
					<%# en dur pour l'instant: %>
						<div class="box bg-success p-3">
						<i class="fa-solid fa-comment-medical"></i>
						<h3>0</h3>
						<p class="lead">Problèmes en attentes</p>
						</div>
					</div>
				</div>
			</section>
		</div>
	</div>


	<%# <div id="graphdiv">
      <div class="card-category">
        <div class="button-container d-flex justify-content-around">
          <div class="btn btn-success" id="day">Jour</div>
          <div class="btn btn-success" id="week">Semaine</div>
          <div class="btn btn-success" id="month">Mois</div>
        </div> %>
        <%# <div class="active" id="day-chart" data-hello_controller-target="chart"> %>
			<%#= column_chart ContainerFillingLevel.group_by_day(:at).average(:level), defer: true, height: "400px", colors: ["#85C883"]%>
		<%# </div>
        <div class="d-none" id="week-chart" data-hello_controller-target="chart"> %>
			<%#= column_chart ContainerFillingLevel.group_by_week(:at).average(:level), defer: true, height: "400px", colors: ["#85C883"]%>
		<%# </div>
        <div class="d-none" id="month-chart" data-hello_controller-target="chart"> %>
			<%#= column_chart ContainerFillingLevel.group_by_month(:at).average(:level), defer: true, height: "400px", colors: ["#85C883"]%>
		<%# </div>
      </div>
    </div> %>

    <div id="truckdiv">
      <div class="card-category" id= "trucks-card">
        <div class="statistics-menu">
            <div>
              <h5>Flotte de véhicules</h5>
            </div>
            <div>
              <%= link_to dashboard_path do %>
                <button type="button" class="btn btn-warning">Voir plus</button>
              <% end %>
            </div>
        </div>
        <div class= "container-plates">
          <ul>
            <%count = 1%>
            <% @trucks.each do |truck| %>
              <div class="container-plate-driver d-flex justify-content-between">

              <!-- Modal -->
              <div class="modal fade" id="modal_<%= truck.id %>" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">INFORMATION</h5>
                      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                      <%= render "trucks/truckshow", truck: truck, count: count %>
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                  </div>
                </div>
              </div>
                <div class="container-plate" data-bs-toggle="modal" data-bs-target="#modal_<%= truck.id %>">
                  <li><span class="registration-ui"><%= truck.plate_number %></span>
                </div>
                <div class="plate-driver">
                  </li>
                </div>
              </div>
              <% count += 1 %>
            <% end %>
          </ul>
        </div>
      </div>
    </div>

    <div id="container-savings">
      <div class="card-category" id= "statistics-card">
        <div class="statistics-menu">
          <div>
            <h5>Economies</h5>
          </div>
          <div>
            <%= link_to dashboard_path do %>
              <button type="button" class="btn btn-warning">Voir plus</button>
            <% end %>
          </div>
        </div>
        <div><%= area_chart Road.group_by_year(:date).average(:kilometers), defer: true, height: "400px", colors: ["#85C883"], ytitle: "km par an"%></div>
      </div>
    </div>
  </div>
</div>

<%# 
<script>
var select_format = () => {
  day = document.getElementById("day");
  week = document.getElementById("week");
  month = document.getElementById("month");

  day.addEventListener("click", (event) => {
     document.getElementById("day-chart").classList.add("active");
     document.getElementById("day-chart").classList.remove("d-none");
     document.getElementById("week-chart").classList.add("d-none");
     document.getElementById("month-chart").classList.add("d-none");

  });

  week.addEventListener("click", (event) => {
    document.getElementById("week-chart").classList.add("active");
    document.getElementById("week-chart").classList.remove("d-none");
    document.getElementById("day-chart").classList.add("d-none");
    document.getElementById("month-chart").classList.add("d-none");
  });

  month.addEventListener("click", (event) => {
     document.getElementById("month-chart").classList.add("active");
     document.getElementById("month-chart").classList.remove("d-none");
       document.getElementById("week-chart").classList.add("d-none");
     document.getElementById("day-chart").classList.add("d-none");
  });
}

select_format();
</script> %>
